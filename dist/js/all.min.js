function getStateFromNewsItems(){return newsItems.get()}function getStateFromNumberOfReaders(){return numberOfReaders.get()}function getStateFromSourceList(){return sourceList.get()}var ObservableThing=function(e){this.thing=e,this.onChangeListener=null};ObservableThing.prototype.set=function(e){this.thing=e,this.notify()},ObservableThing.prototype.get=function(){return this.thing},ObservableThing.prototype.setChangeListener=function(e){this.onChangeListener=e},ObservableThing.prototype.notify=function(){null!==this.onChangeListener&&this.onChangeListener()};var socket=io(),newsItems=new ObservableThing([]),numberOfReaders=new ObservableThing(Number(0)),sourceList=new ObservableThing([]);socket.on("nxws items",function(e){var t=JSON.parse(e);t.date=new Date(t.date),t.constructor==Object&&(t=[t]),t[0].fetchDate=new Date;var a=newsItems.get(),n=t.concat(a);newsItems.set(n)}),socket.on("nxws readers",function(e){numberOfReaders.set(Number(e))}),socket.on("nxws sources",function(e){var t=JSON.parse(e);sourceList.set(t)});var HowCow=React.createClass({displayName:"HowCow",render:function(){return React.createElement("div",{id:"aboutCow"},React.createElement("h2",{id:"cowwhat"},"What?"),React.createElement("p",null,"This is a world news feed. Give it a minute or two for items to be published."),React.createElement("p",null,"It's very easy to search or filter by typing in the box. Instant actually. If you want to keep it, just hit enter and the term will be added to a tag list. You can stack filter tags on top of each other."),React.createElement("ul",{className:"tutTags"},React.createElement("li",{className:"tagItem tagInclude"},React.createElement("button",{type:"button"},"Highland Cows")),React.createElement("li",{className:"tagItem tagInclude"},React.createElement("button",{type:"button"},"Mountain Goats"))),React.createElement("p",null,"As an extra, place a dash (-) at the beginning of the term and you can choose what not to see."),React.createElement("ul",{className:"tutTags"},React.createElement("li",{className:"tagItem tagExclude"},React.createElement("button",{type:"button"},"Beef"))),React.createElement("p",null,"Tags are colour coded, (blue for included, red for excluded) so you will know how the list is being filtered. If you want to remove it, just click it. It's like they were never there. Magic."),React.createElement("p",null,"Click the word 'Sources' (just above the cow) if you wish to see where the news comes from."),React.createElement("p",null,"Take your time, the news will keep coming even as you read this."),React.createElement("h2",{id:"cowwhy"},"Why?"),React.createElement("p",null,"This feed is a little different. It is intended for slow movers and not those who find themselves in a hurry. It intentionally shows nothing when you load it, and from then it will only show news as it is published. It's about the present, at a speed you can work with."),React.createElement("p",null,"You cannot set the source of the news, but you can curate with broad, simple strokes by tagging. Searching is fast too."),React.createElement("h2",{id:"cowhow"},"How?"),React.createElement("p",null,"Read the ",React.createElement("a",{href:"http://github.com/colw/nxws",target:"_blank"},"code")," if you're curious."),React.createElement("h2",{id:"cowwho"},"Who?"),React.createElement("p",{id:"smallwho"},"I can be reached ",React.createElement("a",{href:"mailto:colw@outlook.com"},"here"),"."))}}),NewsCow=React.createClass({displayName:"NewsCow",mixins:[RandomHelpMixin],getInitialState:function(){var e=["Udderly brilliant","News that mooves you","Hoofin' along"];return{cow:"./images/Guernsey_cow.png",cowords:e}},handleClick:function(){this.props.onClickHandler()},render:function(){var e=this.getRandomInteger(0,this.state.cowords.length),t=this.state.cowords[e];return React.createElement("div",{id:"cow",onClick:this.props.onClickHandler},React.createElement("img",{src:this.state.cow,alt:"A black and white cow",title:t}))}}),NewsReaderCount=React.createClass({displayName:"NewsReaderCount",render:function(){var e="";switch(this.props.readerCount){case 0:e="With No Others";break;case 1:e="With 1 Other";break;default:e="With "+this.props.readerCount+" Others"}return React.createElement("span",{id:"readerCount"},e)}}),NewsItemCount=React.createClass({displayName:"NewsItemCount",render:function(){var e=this.props.itemcount,t="";switch(e){case 0:t="No News";break;case 1:t="1 Update";break;default:t=e+" Updates"}return React.createElement("span",{id:"itemCount"},t)}}),NewsSearchBar=React.createClass({displayName:"NewsSearchBar",getInitialState:function(){return{filterText:""}},handleChange:function(){this.props.onUserInput(this.refs.filterTextInput.getDOMNode().value)},handleSubmit:function(e){e.preventDefault();var t=this.refs.filterTextInput.getDOMNode().value;this.props.onFilterSubmit(t)},render:function(){return React.createElement("div",{id:"filterBox"},React.createElement("form",{onSubmit:this.handleSubmit},React.createElement("input",{id:"filterTextInput",ref:"filterTextInput",value:this.props.filterText,type:"search",onChange:this.handleChange,placeholder:"Filter By..."})))}}),NewsTagList=React.createClass({displayName:"NewsTagList",handleClick:function(e){this.props.onTagClick(e.currentTarget.getAttribute("value"))},render:function(){var e=this,t=function(t){var a="tagItem tagInclude",n=t;return"-"===t[0]&&(n=t.slice(1),a="tagItem tagExclude"),React.createElement("li",{key:t,className:a},React.createElement("button",{type:"button",value:t,onClick:e.handleClick},n))};return React.createElement("ul",{id:"tagList"},this.props.filterTags.map(t))}}),NewsSources=React.createClass({displayName:"NewsSources",mixins:[FormatURLMixin],getInitialState:function(){return{showSources:!1}},handleClick:function(){this.setState({showSources:!this.state.showSources})},render:function(){var e=function(e){return React.createElement("li",{key:e,className:"sourceItem"},e)},t=null;return this.state.showSources&&(t=React.createElement("ul",null,this.props.sourceList.map(e))),React.createElement("span",{id:"sourceList",onClick:this.handleClick},"from "+this.props.sourceList.length+" Sources",t)}}),NewsDuration=React.createClass({displayName:"NewsDuration",render:function(){var e=this.props.duration,t="in "+e+(1==e?" Minute":" Minutes");return React.createElement("span",null,t)}}),NewsInfo=React.createClass({displayName:"NewsInfo",render:function(){return React.createElement("div",{id:"newheader"},React.createElement(NewsItemCount,{itemcount:this.props.itemcount})," ",React.createElement(NewsDuration,{duration:this.props.minutes})," ",React.createElement(NewsSources,{sourceList:this.props.sources}))}}),NewsItem=React.createClass({displayName:"NewsItem",mixins:[FormatURLMixin,SetIntervalMixin],getInitialState:function(){return{formattedTimeSince:moment(this.props.info.fetchDate).fromNow()}},componentDidMount:function(){this.setInterval(this.updateTime,3e4)},updateTime:function(){this.setState({formattedTimeSince:moment(this.props.info.fetchDate).fromNow()})},render:function(){var e=this.getBaseURL(this.props.info.metalink);return React.createElement("div",{className:"newsItem"},React.createElement("a",{href:this.props.info.link,target:"_blank"},React.createElement("div",{className:"headTitle"},this.props.info.title)),React.createElement("div",{className:"subTitle"},e,", ",React.createElement("span",{className:"subTime"},this.state.formattedTimeSince)))}}),NewsList=React.createClass({displayName:"NewsList",render:function(){if(0===this.props.newsItems.length)return React.createElement("div",{id:"emptyList"},React.createElement("p",null,"Please wait for some news to be published. Shan't be long."),React.createElement("p",{id:"nogoodnews"},"No news is good moos, right?"));var e=function(e){return React.createElement("li",{key:e.guid},React.createElement(NewsItem,{info:e}))};return React.createElement("ul",null,this.props.newsItems.map(e))}}),NewsApp=React.createClass({displayName:"NewsApp",mixins:[SetIntervalMixin],getInitialState:function(){return{filterText:"",filterTags:[],newsItems:getStateFromNewsItems(),filteredNewsItems:[],numberOfReaders:getStateFromNumberOfReaders(),sourceList:getStateFromSourceList(),minutes:0,showAbout:!1}},tick:function(){this.setState({minutes:this.state.minutes+1})},componentDidMount:function(){newsItems.setChangeListener(this.onStorageChange),numberOfReaders.setChangeListener(this.onReaderChange),sourceList.setChangeListener(this.onSourceListChange),this.setInterval(this.tick,6e4),this.setState({filteredNewsItems:this.state.newsItems.slice()})},onStorageChange:function(){var e=getStateFromNewsItems(),t=this.state.filterTags;this.state.filterText.length>0&&(t=t.concat(this.state.filterText));var a=this.filterListWithTags(e,t);this.setState({newsItems:e,filteredNewsItems:a})},onReaderChange:function(){this.setState({numberOfReaders:getStateFromNumberOfReaders()})},onSourceListChange:function(){var e=getStateFromSourceList();this.setState({sourceList:e})},handleUserInput:function(e){var t=e.toLowerCase();if("-"===t[0])return void this.setState({filterText:e});var a=this.state.filterTags;t.length>0&&(a=a.concat(t));var n=this.filterListWithTags(this.state.newsItems,a);this.setState({filterText:e,filteredNewsItems:n})},handleSubmit:function(e){var t;if(""!==e){if("-"!==e[0])return t=this.state.filterTags.concat(e.toLowerCase()),void this.setState({filterText:"",filterTags:t});t=this.state.filterTags.concat(e.toLowerCase());var a=this.filterListWithTags(this.state.newsItems,t);return void this.setState({filterText:"",filterTags:t,filteredNewsItems:a})}},handleTagClick:function(e){var t=this.state.filterTags.filter(function(t){return t!=e});this.state.filterText.length>0&&(t=t.concat(this.state.filterText));var a=this.filterListWithTags(this.state.newsItems,t);this.setState({filterTags:t,filteredNewsItems:a})},filterListWithTags:function(e,t){if(0===e.length)return[];if(0===t.length)return e;if("-"===t[0])return this.filterListWithTags(e,t.slice(1));var a,n=function(e){return((e.title?e.title:"")+(e.metatitle?e.metatitle:"")+(e.metalink?e.metalink:"")).toLowerCase()},s=function(e,t){return function(t){var a=n(t);return-1!==a.indexOf(e)}},i=function(e,t){return function(t){var a=n(t);return-1===a.indexOf(e)}},r=t[0];return"-"===r[0]?(r=r.slice(1),a=e.filter(i(r))):a=e.filter(s(r)),this.filterListWithTags(a,t.slice(1))},onCowClick:function(e){console.log("click"),this.setState({showAbout:!this.state.showAbout})},render:function(){var e=this.state.showAbout?React.createElement(HowCow,null):React.createElement(NewsList,{newsItems:this.state.filteredNewsItems,filterText:this.state.filterText.toLowerCase(),filterTags:this.state.filterTags});return React.createElement("div",{id:"MainContent"},React.createElement("div",{id:"headerInfo"},React.createElement(NewsInfo,{itemcount:this.state.filteredNewsItems.length,minutes:this.state.minutes,others:this.state.numberOfReaders,sources:this.state.sourceList}),React.createElement(NewsCow,{onClickHandler:this.onCowClick}),React.createElement(NewsSearchBar,{onUserInput:this.handleUserInput,filterText:this.state.filterText,onFilterSubmit:this.handleSubmit}),React.createElement(NewsTagList,{filterTags:this.state.filterTags,onTagClick:this.handleTagClick})),React.createElement("div",{id:"mainList"},e))}});ReactDOM.render(React.createElement(NewsApp,null),document.getElementById("ReactMountPoint"));var FormatURLMixin={getBaseURL:function(e){"http"!=e.slice(0,4)&&(e="http://"+e);var t=document.createElement("a");return t.href=e,t.hostname.replace(/^www./,"")}},RandomHelpMixin={getRandomInteger:function(e,t){return Math.floor(Math.random()*(t-e))+e}},SetIntervalMixin={componentWillMount:function(){this.intervals=[]},setInterval:function(){this.intervals.push(setInterval.apply(null,arguments))},componentWillUnmount:function(){this.intervals.map(clearInterval)}};